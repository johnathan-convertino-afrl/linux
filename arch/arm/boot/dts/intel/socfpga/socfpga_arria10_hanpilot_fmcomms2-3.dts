/dts-v1/;
#include <dt-bindings/interrupt-controller/irq.h>
#include "socfpga_arria10_hanpilot.dtsi"

&mmc {
  status = "okay";
  cap-sd-highspeed;
  broken-cd;
  bus-width = <4>;
};

&eccmgr {
  sdmmca-ecc@ff8c2c00 {
    compatible = "altr,socfpga-sdmmc-ecc";
    reg = <0xff8c2c00 0x400>;
    altr,ecc-parent = <&mmc>;
    interrupts = <15 IRQ_TYPE_LEVEL_HIGH>,
          <47 IRQ_TYPE_LEVEL_HIGH>,
          <16 IRQ_TYPE_LEVEL_HIGH>,
          <48 IRQ_TYPE_LEVEL_HIGH>;
  };
};

/ {
  clocks {
    sys_clk: sys_clk {
      #clock-cells = <0>;
      compatible = "fixed-clock";
      clock-frequency = <100000000>;
      clock-output-names = "system_clock";
    };

    dma_clk: dma_clk {
      #clock-cells = <0x0>;
      compatible = "fixed-clock";
      clock-frequency = <250000000>;
      clock-output-names = "dma_clk";
    };
  };

  soc {
      sys_hps_bridges: bridge@ff200000 {
        compatible = "simple-bus";
        reg = <0xff200000 0x00200000>;
        #address-cells = <1>;
        #size-cells = <1>;
        ranges = <0x00000000 0xff200000 0x00200000>;

      sys_i2c: i2c@80 {
        compatible = "altr,softip-i2c-v1.0";
        reg = <0x00000080 0x00000040>;
        interrupt-parent = <&intc>;
        interrupts = <0 34 IRQ_TYPE_LEVEL_HIGH>;
        clocks = <&sys_clk>;
        clock-frequency = <400000>;
        #address-cells = <1>;
        #size-cells = <0>;
        fifo-size = <64>;

        tmp@1c {
          compatible = "ti,tmp441";
          reg = <0x1c>;
        };
        
        max6650@48 {
          reg = <0x48>;
          compatible = "maxim,max6650";
          maxim,fan-microvolt = <12000000>;
          maxim,fan-prescale = <4>;
          maxim,fan-target-rpm = <6000>;
        };
        
        ltc2945@6a {
          compatible = "ltc2945";
          reg = <0x6a>;
        };
        

        mpu9250@69 {
          compatible = "invensense,mpu9250";
          reg = <0x69>;
          interrupt-parent = <&intc>;
          interrupts = <0 51 IRQ_TYPE_LEVEL_HIGH>;
        };

      };
      
      fmc_i2c: i2c@C0 {
        compatible = "altr,softip-i2c-v1.0";
        reg = <0x000000C0 0x00000040>;
        interrupt-parent = <&intc>;
        interrupts = <0 35 IRQ_TYPE_LEVEL_HIGH>;
        clocks = <&sys_clk>;
        clock-frequency = <100000>;
        #address-cells = <1>;
        #size-cells = <0>;
        fifo-size = <128>;
      };

      sys_gpio_bd: sys-gpio-bd@10 {
        compatible = "altr,pio-16.0", "altr,pio-1.0";
        reg = <0x00000010 0x00000010>;
        altr,gpio-bank-width = <32>;
        #gpio-cells = <2>;
        gpio-controller;
      };

      sys_gpio_in: sys-gpio-in@0 {
        compatible = "altr,pio-16.0", "altr,pio-1.0";
        reg = <0x00000000 0x00000010>;
        altr,gpio-bank-width = <32>;
        #gpio-cells = <2>;
        gpio-controller;
      };

      sys_gpio_out: sys_gpio_out@20 {
        compatible = "altr,pio-1.0";
        reg = <0x00000020 0x00000010>;
        altr,gpio-bank-width = <32>;
        resetvalue = <0>;
        #gpio-cells = <2>;
        gpio-controller;
      };

      sys_spi: spi@40 {
        compatible = "altr,spi-1.0";
        reg = <0x00000040 0x00000020>;
        interrupt-parent = <&intc>;
        interrupts = <0 26 IRQ_TYPE_LEVEL_HIGH>;
        #address-cells = <0x1>;
        #size-cells = <0x0>;
      };

      cf_ad9361_adc_core_0: cf-ad9361-lpc@40000 {
        compatible = "adi,axi-ad9361-6.00.a";
        reg = <0x00040000 0x6000>;
        dmas = <&adc_dma 0>;
        dma-names = "rx";
        spibus-connected = <&adc0_ad9361>;
      };

      cf_ad9361_dac_core_0: cf-ad9361-dds-core-lpc@44000  {
        compatible = "adi,axi-ad9361-dds-6.00.a";
        reg = <0x00044000 0x6000>;
        dmas = <&dac_dma 0>;
        dma-names = "tx";
        clocks = <&adc0_ad9361 13>;
        clock-names = "sampl_clk";
      };

      adc_dma: adc_dma@50000 {
        compatible = "adi,axi-dmac-1.00.a";
        reg = <0x00050000 0x1000>;
        interrupt-parent = <&intc>;
        interrupts = <0 21 IRQ_TYPE_LEVEL_HIGH>;
        #dma-cells = <1>;
        clocks = <&dma_clk>;

        adi,channels {
          #size-cells = <0>;
          #address-cells = <1>;
          dma-channel@0 {
            reg = <0>;
            adi,source-bus-width = <64>;
            adi,source-bus-type = <2>;
            adi,destination-bus-width = <128>;
            adi,destination-bus-type = <0>;
          };
        };
      };

      dac_dma: dac_dma@54000 {
        compatible = "adi,axi-dmac-1.00.a";
        reg = <0x00054000 0x1000>;
        interrupt-parent = <&intc>;
        interrupts = <0 22 IRQ_TYPE_LEVEL_HIGH>;
        #dma-cells = <1>;
        clocks = <&dma_clk>;
        adi,channels {
          #size-cells = <0>;
          #address-cells = <1>;
          dma-channel@0 {
            reg = <0>;
            adi,source-bus-width = <64>;
            adi,source-bus-type = <0>;
            adi,destination-bus-width = <64>;
            adi,destination-bus-type = <2>;
          };
        };
      };
    };
  };
};


#define fmc_spi sys_spi

#include "../adi-fmcomms2.dtsi"

&adc0_ad9361 {
  /delete-property/ spi-cpha;

  adi,rx-data-delay = <0>;
  adi,rx-data-clock-delay = <0>;
  adi,lvds-bias-mV = <200>;
  
  /* adi,lvds-rx-onchip-termination-enable; */
  
  /* GPIO */
  reset-gpios = <&sys_gpio_out 14 0>;
  sync-gpios = <&sys_gpio_out 13 0>;
  en_agc-gpios = <&sys_gpio_out 12 0>;

  /* AXI Converter */
  /*adi,axi-half-dac-rate-enable;*/
  adi,bb-clk-change-dig-tune-enable;
};

/delete-node/ &ad7291;

/delete-node/ &eeprom;

&fmc_i2c {
  ad7291: ad7291@20 {
    compatible = "adi,ad7291";
    reg = <0x20>;
  };

  eeprom: eeprom@53 {
    compatible = "at24,24c02";
    reg = <0x53>;
  };
};

